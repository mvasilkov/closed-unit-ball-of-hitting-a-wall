(function(){var b=b||{};b.scope={};b.ASSUME_ES5=!1;b.ASSUME_NO_NATIVE_MAP=!1;b.ASSUME_NO_NATIVE_SET=!1;b.defineProperty=b.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,d){a!=Array.prototype&&a!=Object.prototype&&(a[c]=d.value)};b.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};b.global=b.getGlobal(this);b.SYMBOL_PREFIX="jscomp_symbol_";
b.initSymbol=function(){b.initSymbol=function(){};b.global.Symbol||(b.global.Symbol=b.Symbol)};b.Symbol=function(){var a=0;return function(c){return b.SYMBOL_PREFIX+(c||"")+a++}}();b.initSymbolIterator=function(){b.initSymbol();var a=b.global.Symbol.iterator;a||(a=b.global.Symbol.iterator=b.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&b.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return b.arrayIterator(this)}});b.initSymbolIterator=function(){}};
b.arrayIterator=function(a){var c=0;return b.iteratorPrototype(function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}})};b.iteratorPrototype=function(a){b.initSymbolIterator();a={next:a};a[b.global.Symbol.iterator]=function(){return this};return a};b.makeIterator=function(a){b.initSymbolIterator();b.initSymbol();b.initSymbolIterator();var c=a[Symbol.iterator];return c?c.call(a):b.arrayIterator(a)};b.arrayFromIterator=function(a){for(var c,d=[];!(c=a.next()).done;)d.push(c.value);return d};
var e={},h=window.Dropbox;function k(){var a={};location.hash.replace(/^#/,"").split("&").map(function(a){return a.split("=")}).forEach(function(c){var d=b.makeIterator(c);c=d.next().value;d=b.arrayFromIterator(d);a[decodeURIComponent(c)]=decodeURIComponent(d.join("="))});return a}var l={".tag":"overwrite"};
e.ClientStorage=function(a,c){var d=c.accessToken,g=c.clientId;c=c.saveAccessToken;null==d&&(d=k().access_token)&&c&&c(d);this.db=new h.Dropbox({accessToken:d,clientId:g});this.path=a.startsWith("/")?a:"/"+a};e.ClientStorage.prototype.authenticated=function(){return this.db.getAccessToken()?this.db.usersGetSpaceUsage(void 0).then(function(){return!0}).catch(function(){return!1}):Promise.resolve(!1)};e.ClientStorage.prototype.authenticationUrl=function(a){return this.db.getAuthenticationUrl(a)};
e.ClientStorage.prototype.load=function(a){var c=this;return new Promise(function(d,g){c.db.filesDownload({path:c.path}).then(function(a){var c=new FileReader;c.addEventListener("loadend",function(){return d(c.result)});c.readAsText(a.fileBlob,"utf-8")}).catch(function(c){var f=c.error;"string"==typeof f&&(f=JSON.parse(f).error);"path"==f[".tag"]&&"not_found"==f.path[".tag"]?d(a||""):g(c)})})};
e.ClientStorage.prototype.save=function(a){var c=this;return new Promise(function(d){c.db.filesUpload({contents:a,path:c.path,mode:l}).then(function(){return d(!0)}).catch(function(){return d(!1)})})};window.ClientStorage=e.ClientStorage;})()